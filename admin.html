<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Painel Administrativo - Mega Tech</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- Todo o teu HTML de login e alterar credenciais continua igual (não mexi no visual) -->
<header><h1>Painel Administrativo Mega Tech</h1></header>

<div id="loginContainer" class="admin-container" style="display:block;">
    <h2>Login</h2>
    <div class="input-group"><label>Usuário</label><input id="loginUser"></div>
    <div class="input-group"><label>Senha</label><input type="password" id="loginPass"></div>
    <button onclick="fazerLogin()">Entrar</button>
    <br><br>
    <button id="epe" onclick="mostrarAlteracoes()" style="background:#444;">Alterar credenciais</button>
</div>

<!-- ALTERAR CREDENCIAIS (mesmo visual) -->
<div id="alterarContainer" class="admin-container" style="display:none;">
    <h2>Alterar Credenciais</h2>
    <button onclick="mostrarAlterarUser()">Alterar usuário</button><br><br>
    <button onclick="mostrarAlterarPass()">Alterar senha</button><br><br>
    <button onclick="voltarLogin()">Voltar ao Login</button>
</div>

<div id="alterarUser" class="admin-container" style="display:none;">
    <h2>Novo Usuário</h2>
    <input placeholder="Usuário atual" id="oldUser"><br><br>
    <input placeholder="Novo usuário" id="newUser"><br><br>
    <input placeholder="Confirmar novo" id="newUser2"><br><br>
    <button onclick="salvarNovoUser()">Salvar</button><br><br>
    <button onclick="mostrarAlteracoes()">Voltar</button>
</div>

<div id="alterarPass" class="admin-container" style="display:none;">
    <h2>Nova Senha</h2>
    <input type="password" placeholder="Senha atual" id="oldPass"><br><br>
    <input type="password" placeholder="Nova senha" id="newPass"><br><br>
    <input type="password" placeholder="Confirmar nova" id="newPass2"><br><br>
    <button onclick="salvarNovaPass()">Salvar</button><br><br>
    <button onclick="mostrarAlteracoes()">Voltar</button>
</div>

<!-- PAINEL DE PRODUTOS (igual ao anterior) -->
<div id="adminReal" class="admin-container" style="display:none;">
    <div class="div"><h2>Adicionar Produto</h2><a href="index.html" target="_blank">Ver loja</a></div>
    <div class="input-group"><label>Nome</label><input id="nome"></div>
    <div class="input-group"><label>Preço</label><input id="preco"></div>
    <div class="input-group"><label>Descrição (opcional)</label><textarea id="descricao"></textarea></div>
    <div class="input-group"><label>Foto</label><input type="file" id="imagemUpload" accept="image/*"></div>
    <button onclick="adicionarProduto()">Adicionar Produto</button>

    <h2 style="margin-top:40px;">Produtos no site</h2>
    <div id="produtosAdmin"></div>

    <br><br>
    <button onclick="logout()" style="background:#a00;">Sair</button>
</div>

<script>
    // TUAS CHAVES DO SUPABASE
    const supabaseUrl = 'https://tizkxplysjadtlrziomg.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpemt4cGx5c2phZHRscnppb21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMDgyNTIsImV4cCI6MjA4MDU4NDI1Mn0.XyLjvbLV7FR0GEpc28XPQJQVSrZnbWhsAUVpjMI4OW4';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

    // LOGIN COM SUPABASE
    async function fazerLogin() {
        const user = document.getElementById("loginUser").value;
        const pass = document.getElementById("loginPass").value;

        const { data, error } = await supabase
            .from('admin_credentials')            .select('*')            .limit(1)            .single();

        if (error || !data) return alert("Erro no login");

        if (user === data.username && pass === data.password) {
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("adminReal").style.display = "block";
            carregarAdmin();
        } else {
            alert("Usuário ou senha incorretos!");
        }
    }

    // ALTERAR USUÁRIO
    async function salvarNovoUser() {
        const old = document.getElementById("oldUser").value;
        const n1 = document.getElementById("newUser").value;
        const n2 = document.getElementById("newUser2").value;

        const { data } = await supabase.from('admin_credentials').select('*').limit(1).single();

        if (old !== data.username) return alert("Usuário atual errado!");
        if (n1 !== n2) return alert("Os usuários não coincidem!");

        await supabase.from('admin_credentials').update({ username: n1 });
        alert("Usuário alterado!");
        voltarLogin();
    }

    // ALTERAR SENHA
    async function salvarNovaPass() {
        const old = document.getElementById("oldPass").value;
        const p1 = document.getElementById("newPass").value;
        const p2 = document.getElementById("newPass2").value;

        const { data } = await supabase.from('admin_credentials').select('*').limit(1).single();

        if (old !== data.password) return alert("Senha atual errada!");
        if (p1 !== p2) return alert("As senhas não coincidem!");

        await supabase.from('admin_credentials').update({ password: p1 });
        alert("Senha alterada com sucesso!");
        voltarLogin();
    }

    // AS FUNÇÕES DE PRODUTOS CONTINUAM EXATAMENTE AS MESMAS DO CÓDIGO ANTERIOR
    async function adicionarProduto() { /* ← código igual ao anterior */ }
    async function carregarAdmin() { /* código igual ao anterior */ }
    async function remover(id) { /* código igual ao anterior */ }

    // Copia aqui as 3 funções de produto do meu último admin.html (adicionarProduto, carregarAdmin, remover)
    // (são as mesmas que te dei antes, não mudei nada nelas)

</script>
</body>
</html>